---
layout: default
---

<div id="main-content">
    <h1>CryptoRecap</h1>
    <p>Riassunto Crypto Trading News</p>
    
    <div id="date-selector-container">
        <h2>Seleziona Data</h2>
        <input type="date" id="date-selector">
    </div>

    <div id="news-container">
        <!-- I post verranno caricati qui dinamicamente -->
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
<script>
    const converter = new showdown.Converter();
    let allPosts = [];

    async function loadPosts() {
    try {
        const response = await fetch('posts.json');
        if (!response.ok) {
            throw new Error('Errore nel caricamento dell\'indice dei post');
        }
        allPosts = await response.json();
        console.log("Contenuto di posts.json:", JSON.stringify(allPosts, null, 2));
        console.log("Numero totale di post:", allPosts.length);

        const latestDate = allPosts.reduce((latest, post) => {
            return post.date > latest ? post.date : latest;
        }, "1970-01-01");

        console.log("Data più recente:", latestDate);
        document.getElementById('date-selector').value = latestDate;
        await displayPostsByDate(latestDate);
    } catch (error) {
        console.error('Errore:', error);
        document.getElementById('news-container').innerHTML = '<p>Errore nel caricamento delle notizie.</p>';
    }
}

    async function displayPostsByDate(date) {
    console.log("Data selezionata:", date);
    const container = document.getElementById('news-container');
    container.innerHTML = '';

    const filteredPosts = allPosts.filter(post => post.date === date);
    console.log("Post filtrati per la data:", filteredPosts);

    if (filteredPosts.length === 0) {
        container.innerHTML = '<p>Nessuna notizia disponibile per questa data.</p>';
        return;
    }

    for (const post of filteredPosts) {
        try {
            console.log(`Tentativo di caricamento del post: ${post.filename}`);
            const markdown = await fetchMarkdownPost(post.filename);
            const html = converter.makeHtml(markdown);
            const postElement = createPostElement(html, post.source);
            container.appendChild(postElement);
        } catch (error) {
            console.error(`Errore nel caricamento del post ${post.filename}:`, error);
        }
    }
}
    async function fetchMarkdownPost(filename) {
    try {
        const baseUrl = 'https://raw.githubusercontent.com/bbnss/yourecap.github.io/main/';
        const response = await fetch(`${baseUrl}posts/${filename}`);
        console.log(`Tentativo di caricamento: ${baseUrl}posts/${filename}`);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return await response.text();
    } catch (error) {
        console.error(`Errore nel caricamento del post ${filename}:`, error);
        return `# Errore nel caricamento del post\n\nNon è stato possibile caricare il post "${filename}". Errore: ${error.message}`;
    }
}

    function createPostElement(html, source) {
        const postElement = document.createElement('div');
        postElement.className = 'news-item';
        postElement.innerHTML = html;

        const sourceElement = document.createElement('p');
        sourceElement.className = 'source';
        sourceElement.textContent = `Fonte: ${source}`;
        postElement.appendChild(sourceElement);

        return postElement;
    }

    document.getElementById('date-selector').addEventListener('change', (event) => {
        displayPostsByDate(event.target.value);
    });

    // Carica i post iniziali
    loadPosts();
</script>

<style>
    #main-content {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    .news-item {
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #ccc;
    }
    .source {
        font-size: 0.8em;
        color: #666;
    }
    #date-selector-container {
        margin-bottom: 20px;
    }
</style>
